<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thrush Gains - Register</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text color */
            overflow-x: hidden; /* Prevent horizontal scroll */
        }
        /* Preloader styles */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #1a202c;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
        }
        .preloader-hidden {
            opacity: 0 !important;
            visibility: hidden !important;
        }
        .preloader-icon {
            animation: spin 1.5s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Gradient for buttons and accents */
        .btn-gradient {
            background: linear-gradient(to right, #4A90E2, #50E3C2);
            transition: all 0.3s ease;
        }
        .btn-gradient:hover {
            box-shadow: 0 0 15px rgba(74, 144, 226, 0.6), 0 0 30px rgba(80, 227, 194, 0.4);
            transform: translateY(-2px);
        }

        /* Input field styling */
        .form-input {
            background-color: #2d3748; /* Darker input background */
            border: 1px solid #4a5568; /* Subtle border */
            color: #e2e8f0;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .form-input:focus {
            outline: none;
            border-color: #4A90E2; /* Blue focus border */
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.5); /* Blue glow on focus */
        }

        /* Card background */
        .card-bg {
            background-color: #2d3748; /* Slightly lighter dark for cards */
        }

        /* Responsive text sizes for message boxes */
        .message-box-text {
            font-size: 0.875rem; /* text-sm default */
        }
        @media (max-width: 640px) {
            .message-box-text {
                font-size: 0.75rem; /* text-xs on small screens */
            }
        }

        /* Modal specific styles */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }
        .modal-content {
            background-color: #2d3748;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            animation: fadeInScaleUp 0.3s ease-out forwards;
        }
        @keyframes fadeInScaleUp {
            from { opacity: 0; transform: scale(0.9) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- Preloader -->
    <div id="preloader">
        <svg class="preloader-icon w-20 h-20 text-blue-500" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm.006 17.065c-2.704 0-4.475-1.574-4.636-3.837h2.06c.108.974.887 1.638 2.576 1.638 1.48 0 2.276-.645 2.276-1.517 0-.901-.635-1.378-2.316-2.127-1.928-.867-3.159-1.996-3.159-3.79 0-1.854 1.5-3.35 4.318-3.35 2.181 0 3.665.805 4.32 2.223h-2.03c-.225-.97-1.107-1.428-2.274-1.428-1.205 0-1.85.546-1.85 1.341 0 .809.522 1.157 1.935 1.77 2.056.885 3.197 2.18 3.197 3.906 0 2.074-1.63 3.522-4.57 3.522z"/>
        </svg>
        <p class="text-blue-400 text-lg mt-4">Loading Thrush Gains...</p>
    </div>

    <!-- Registration Container -->
    <div class="w-full max-w-md card-bg rounded-lg shadow-2xl p-6 sm:p-8 md:p-10 transform transition-all duration-300 scale-95 md:scale-100 opacity-0" id="register-container">
        <!-- Logo/Title -->
        <div class="flex items-center justify-center space-x-2 mb-6">
            <svg class="h-10 w-10 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm2-1a1 1 0 11-2 0 1 1 0 012 0zm3 1a1 100-2 1 1 0 000 2zm-2 1a1 1 0 11-2 0 1 1 0 012 0zm3 1a1 100-2 1 1 0 000 2zm-2 1a1 1 0 11-2 0 1 1 0 012 0zm-3 1a1 1 0 100-2 1 1 0 000 2zm2 1a1 1 0 11-2 0 1 1 0 012 0z" clip-rule="evenodd"></path>
            </svg>
            <h2 class="text-3xl font-bold text-white">Register for Thrush Gains</h2>
        </div>

        <!-- Registration Form -->
        <form id="register-form" class="space-y-4">
            <div>
                <label for="full-name" class="block text-sm font-medium text-gray-300 mb-1">Full Name</label>
                <input type="text" id="full-name" name="full_name" required class="w-full form-input" placeholder="">
            </div>
            <div>
                <label for="username" class="block text-sm font-medium text-gray-300 mb-1">Username</label>
                <input type="text" id="username" name="username" required class="w-full form-input" placeholder="">
            </div>
            <div>
                <label for="email-address" class="block text-sm font-medium text-gray-300 mb-1">Email address</label>
                <input type="email" id="email-address" name="email_address" required class="w-full form-input" placeholder="">
            </div>
            <div>
                <label for="dob" class="block text-sm font-medium text-gray-300 mb-1">Date of Birth</label>
                <input type="date" id="dob" name="dob" required class="w-full form-input">
            </div>
            <div>
                <label for="country" class="block text-sm font-medium text-gray-300 mb-1">Country</label>
                <input type="text" id="country" name="country" required class="w-full form-input" placeholder="United States">
            </div>
            <div>
                <label for="city" class="block text-sm font-medium text-gray-300 mb-1">City</label>
                <input type="text" id="city" name="city" required class="w-full form-input" placeholder="New York">
            </div>
            <!-- <div>
                <label for="workplace" class="block text-sm font-medium text-gray-300 mb-1">Where do you work?</label>
                <input type="text" id="workplace" name="workplace" class="w-full form-input" placeholder="ABC Company (Optional)">
            </div> -->
            <div>
                <label for="password" class="block text-sm font-medium text-gray-300 mb-1">Password</label>
                <input type="password" id="password" name="password" required class="w-full form-input">
            </div>
            <div>
                <label for="confirm-password" class="block text-sm font-medium text-gray-300 mb-1">Confirm Password</label>
                <input type="password" id="confirm-password" name="confirm_password" required class="w-full form-input">
            </div>
            <div>
                <label for="transaction-pin" class="block text-sm font-medium text-gray-300 mb-1">Transaction PIN (4-digit)</label>
                <input type="text" id="transaction-pin" name="transaction_pin" required maxlength="4" pattern="\d{4}" class="w-full form-input" placeholder="e.g., 1234">
            </div>

            <button type="submit" class="w-full btn-gradient text-white py-2 px-4 rounded-lg font-semibold flex items-center justify-center" id="register-btn">
                <span id="register-btn-text">Register Account</span>
                <svg id="register-spinner" class="animate-spin h-5 w-5 ml-3 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </button>
        </form>

        <!-- Login Link -->
        <div class="mt-6 text-center text-gray-400 text-sm">
            <p>Already have an account? <a href="login.html" class="text-blue-400 hover:text-blue-500 font-medium transition-colors duration-200">Login here</a></p>
        </div>
    </div>

    <!-- Message Box (Modal) -->
    <div id="message-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 hidden modal-overlay">
        <div class="modal-content bg-gray-800 p-6 rounded-lg shadow-xl max-w-sm w-full text-center relative mx-4">
            <h3 id="message-modal-title" class="text-xl font-bold text-white mb-3"></h3>
            <p id="message-modal-text" class="text-gray-300 mb-6 message-box-text"></p>
            <button id="message-modal-close-btn" class="btn-gradient text-white py-2 px-4 rounded-lg font-semibold w-full">Close</button>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Firebase CDN Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, sendEmailVerification } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

        // Your Firebase Configuration (Provided by User)
        const firebaseConfig = {
            apiKey: "AIzaSyAg4uAaMhUsZaA3bTfRuHy7kNfnalYzE-o",
            authDomain: "thrushgains.firebaseapp.com",
            projectId: "thrushgains",
            storageBucket: "thrushgains.firebasestorage.app",
            messagingSenderId: "859074169386",
            appId: "1:859074169386:web:55d1fd673abe58e0405153",
            measurementId: "G-4HQKL3MLLE"
        };

        // Deriving appId from projectId as a best practice for consistent Realtime Database paths
        // This ensures your database path (artifacts/thrushgains/users/...) matches your project ID.
        const appId = firebaseConfig.projectId;

        let app;
        let auth;
        let db;

        // UI elements
        const preloader = document.getElementById('preloader');
        const registerContainer = document.getElementById('register-container');
        const registerForm = document.getElementById('register-form');
        const registerBtn = document.getElementById('register-btn');
        const registerBtnText = document.getElementById('register-btn-text');
        const registerSpinner = document.getElementById('register-spinner');

        const messageModal = document.getElementById('message-modal');
        const messageModalTitle = document.getElementById('message-modal-title');
        const messageModalText = document.getElementById('message-modal-text');
        const messageModalCloseBtn = document.getElementById('message-modal-close-btn');

        // Function to show custom message box (modal)
        function showMessageBox(title, message) {
            messageModalTitle.textContent = title;
            messageModalText.textContent = message;
            messageModal.classList.remove('hidden');
        }

        // Function to hide custom message box
        function hideMessageBox() {
            messageModal.classList.add('hidden');
        }

        messageModalCloseBtn.addEventListener('click', hideMessageBox);

        // Utility to handle button loading states
        function setButtonLoading(button, textSpan, spinner, isLoading) {
            if (isLoading) {
                textSpan.classList.add('hidden');
                spinner.classList.remove('hidden');
                button.disabled = true;
            } else {
                textSpan.classList.remove('hidden');
                spinner.classList.add('hidden');
                button.disabled = false;
            }
        }

        // Initialize Firebase
        async function initializeFirebase() {
            try {
                // Check if firebaseConfig is not empty
                if (Object.keys(firebaseConfig).length > 0 && firebaseConfig.apiKey) {
                    app = initializeApp(firebaseConfig);
                    auth = getAuth(app);
                    db = getDatabase(app); // Initialize Realtime Database
                    console.log("Firebase initialized successfully with provided config.");
                } else {
                    showMessageBox("Firebase Error", "Firebase config is missing or invalid. Please check your environment settings.");
                    console.error("Firebase config is missing or invalid.");
                }
            } catch (error) {
                console.error("Error initializing Firebase:", error);
                showMessageBox("Initialization Error", `Failed to initialize Firebase: ${error.message}.`);
            } finally {
                // Hide preloader once Firebase is initialized
                preloader.classList.add('preloader-hidden');
                registerContainer.classList.add('scale-100', 'opacity-100'); // Show container with animation
            }
        }

        // Registration logic
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            setButtonLoading(registerBtn, registerBtnText, registerSpinner, true);

            const fullName = registerForm['full-name'].value;
            const username = registerForm['username'].value;
            const email = registerForm['email-address'].value;
            const dob = registerForm['dob'].value;
            const country = registerForm['country'].value;
            const city = registerForm['city'].value;
            // const workplace = registerForm['workplace'].value;
            const password = registerForm['password'].value;
            const confirmPassword = registerForm['confirm-password'].value;
            const transactionPin = registerForm['transaction-pin'].value;

            if (password !== confirmPassword) {
                showMessageBox("Error", "Passwords do not match.");
                setButtonLoading(registerBtn, registerBtnText, registerSpinner, false);
                return;
            }
            if (password.length < 6) {
                showMessageBox("Error", "Password should be at least 6 characters.");
                setButtonLoading(registerBtn, registerBtnText, registerSpinner, false);
                return;
            }
            if (!/^\d{4}$/.test(transactionPin)) {
                showMessageBox("Error", "Transaction PIN must be a 4-digit number.");
                setButtonLoading(registerBtn, registerBtnText, registerSpinner, false);
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                console.log("User registered:", user.email);

                // --- Send Email Verification ---
                await sendEmailVerification(user);
                console.log("Verification email sent to:", user.email);
                // --- End Send Email Verification ---

                // Store additional user data in Realtime Database
                // Path: artifacts/{appId}/users/{user.uid}/profile
                const userRef = ref(db, `artifacts/${appId}/users/${user.uid}/profile`);
                await set(userRef, {
                    fullName: fullName,
                    username: username,
                    email: email,
                    dateOfBirth: dob,
                    country: country,
                    city: city,
                    // workplace: workplace,
                    transactionPin: transactionPin, // IMPORTANT: In a production environment, transaction PINs should be securely hashed and never stored in plain text.
                    registeredAt: new Date().toISOString()
                });

                showMessageBox(
                    "Registration Successful! ðŸŽ‰", 
                    "Your account has been created. Please check your email to verify your account before logging in. You might need to check your spam folder."
                );
                // Optionally redirect to login page after successful registration
                // setTimeout(() => { window.location.href = 'login.html'; }, 5000); // Give user time to read message

            } catch (error) {
                console.error("Registration failed:", error);
                let errorMessage = "Registration failed. Please try again.";
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = "This email is already registered. Please login.";
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = "Please enter a valid email address.";
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = "Password is too weak. It must be at least 6 characters.";
                }
                showMessageBox("Registration Failed", errorMessage);
            } finally {
                setButtonLoading(registerBtn, registerBtnText, registerSpinner, false);
            }
        });

        // Initialize Firebase when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', initializeFirebase);

        // Preloader hiding on window load
        window.addEventListener('load', () => {
            preloader.classList.add('preloader-hidden');
            // Give a slight delay before revealing the register container for animation
            setTimeout(() => {
                registerContainer.classList.add('scale-100', 'opacity-100');
            }, 100);
        });
    </script>
      <!--Start of Tawk.to Script-->
<script type="text/javascript">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/68a44b7e0f9cc91929d548ba/1j30sdqct';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>
<!--End of Tawk.to Script-->
</body>
</html>
